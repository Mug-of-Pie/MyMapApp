# Map App

Мобильное приложение для работы с интерактивной картой, добавлением пользовательских маркеров, их редактированием, просмотром информации и изображений, а также отправкой уведомлений при приближении к ним.

---

## Установка и запуск

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Mug-of-Pie/MyMapApp.git
````

2. Перейдите в директорию проекта:

   ```bash
   cd map-app
   ```

3. Установите зависимости:

   ```bash
   npm install
   ```

4. Запустите проект:

   ```bash
   npx expo start
   ```

5. Отсканируйте QR-код в приложении **Expo Go** и дождитесь полной загрузки.

---

## Ключевые решения

### Лабораторная №1 — Работа с картой и маркерами

* При запуске загружается карта города Перми.
* Долгое нажатие на карту добавляет новый маркер:

  * Генерируется уникальный ID.
  * Название автоматически: `"Маркер {N}"`.
  * Описание по умолчанию пустое.
  * Адрес определяется по координатам с использованием OpenStreetMap (на русском языке).
* Нажатие на маркер открывает меню действий:

  * Просмотр информации
  * Удаление
  * Отмена
* Просмотр информации позволяет редактировать:

  * Название, описание, изображения
  * Адрес отображается, но не редактируется
* Управление состоянием маркеров реализовано через глобальное хранилище **Zustand**.
* Также добавлен предпросмотр изображений при добавлении в данные о маркере

---

### Лабораторная №2 — SQLite

Zustand заменён на локальную базу данных **SQLite**. Реализовано:

#### Структура БД:

```sql
CREATE TABLE IF NOT EXISTS markers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  latitude REAL NOT NULL,
  longitude REAL NOT NULL,
  title CHAR NOT NULL,
  description TEXT,
  address TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS marker_images (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  marker_id INTEGER NOT NULL,
  uri TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (marker_id) REFERENCES markers (id) ON DELETE CASCADE
);
```

#### Логика:

* При загрузке карты:

  * Инициализируется база данных
  * Загружается базовая информация о маркерах
* При открытии информации о маркере:

  * Загружается полная информация (описание, адрес, изображения)
* Компоненты:

  * `schema.ts`: подключение и создание таблиц
  * `operations.ts`: CRUD-операции с логированием ошибок
  * `DatabaseContext.ts`: централизованное управление работой с БД

---

### Лабораторная №3 — Тестирование и уведомления

#### Тестирование (Android):

1. Тестирование проводилось на эмуляторе Android - BlueStacks
2. Эмулятор позволяет устаналивать желаему геопозицию пользователя на карте

#### Сценарии:

1. **Одна метка** — приход уведомления при приближении
2. **Несколько меток** — уведомления по каждой метке
3. **Выход и повторный вход в зону метки** — повторные уведомления
4. **Фоновый режим** — уведомления не приходят
5. **Перезагрузка устройства** — все уведомления очищаются и приходят заново при приближении

#### Стратегия уведомлений:

* Создан отдельный класс для работы с уведомлениями
* Используется формула Хаверсина для расчета расстояния (100 м)
* Повторные уведомления не отправляются, пока пользователь не выйдет из зоны действия
* При выходе уведомление удаляется из активных

#### Ограничения:

* Не работают уведомления без разрешений
* Не работают при отключённой геолокации

* Также реализована кнопка для перемещения экрана к местонахождению пользователя

---

## Известные проблемы

* При слишком близком нахождении точки пользователя и маркера при нажатии на маркер может нажаться точка пользователя. Необходимо повторное нажание для перехода на маркер.

---

## Видео демонстрация

https://drive.google.com/file/d/1cr2iGieguGKE6bx5HQv0BQHgCkRxlHee/view?usp=sharing

```

---

Готов обновлять следующий файл!
```
